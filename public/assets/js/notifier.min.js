(function ($) {

    var notifierUrl, notifierLoad;

    $.fn.notifier = function(options) {
        var settings = $.extend({
            enabled: true,
            pageLoad: true,
            ajaxLoad: true,
            clickToHide: true,
            autoHide: true,
            autoHideDelay: 5000,
            globalPosition: 'top right',
            style: 'bootstrap',
            className: 'error',
            showAnimation: 'slideDown',
            showDuration: 1000,
            hideAnimation: 'slideUp',
            hideDuration: 200,
            gap: 1
        }, options);

        if ($(location).attr('href').indexOf('public') > -1) {
            notifierUrl = $(location).attr('href').split('public')[0] + 'public/notifier/notifications';
        } else {
            notifierUrl = $(location).attr('protocol') + '//' + $(location).attr('hostname') + '/notifier/notifications';
        }

        notifierLoad = function () {
            $.getJSON(notifierUrl,
                function(data) {
                    $.each(data.notifications,
                        function(key, item)  {
                            $.notify(item.message, item.type, $.extend(settings, item.options));
                        }
                    );
                }
            );
        }

        if (settings.enabled && settings.pageLoad) {
            notifierLoad();
        }

        $(document).ajaxComplete(function(evt, xhr, settings) {
            if (settings.enabled && settings.ajaxLoad && settings.url != notifierUrl) {
                notifierLoad();
            }
        });

        return this;
    };

}( jQuery ));